<html>
<head>

<title>QReal:Robots</title>

<meta http-equiv="content-type" content="text/html; charset=utf-8" />

</head>
<body>

<h2>Создание программ в QReal:Robots</h2>

<h3><a name="diagrams">Создание диаграмм</a></h3>

Программа в QReal:Robots представляется в виде последовательности блоков, соединённых связями, каждой программе соответствует отдельная диаграмма. Для того, чтобы создать новую диаграмму, нужно нажать на иконку с надписью "Диаграмма поведения робота" в палитре и, не отпуская левую кнопку мыши, перетащить ее в область обозревателя диаграмм:

<br/><br/>

<center><img src="pics/programming-beginning.png" alt="Создание диаграммы"></center>

<br/><br/>

<div>
В результате в обозревателе появится строка "Диаграмма поведения робота", что является названием диаграммы по умолчанию. При желании его можно сменить, выделив данный элемент в обозревателе и дважды нажав на текст имени. 
</div>

<br/><br/>

Чтобы открыть диаграмму для редактирования, необходимо кликнуть на нужном элементе в обозревателе диаграмм. В случае пустой диаграммы экран приложения будет выглядеть следующим образом:

<br/><br/>

<center><img src="pics/programming-empty.png" alt="Пустая диаграмма"></center>

<br/><br/>

Теперь на диаграмму можно добавлять элементы и формировать из них программу управления роботом.

<h3><a name="blocks">Создание блоков</a></h3>

Блоки в QReal:Robots создаются перетаскиванием соответствующих иконок из палитры элементов на диаграмму. Рассмотрим доступные типы блоков:

<h4>Служебные блоки</h4>

<table cellspacing="2" border="1" cellpadding="5" width="800" >
  <tr>
    <td>Название элемента</td>
    <td>Пиктограмма</td>
    <td>Описание</td>
  </tr>
  <tr>
    <td>Начало</td>
    <td><img src="pics/blocks-initialBlock.png" alt="Начало"></td>
    <td>Начальная точка выполнения программы. На каждой диаграмме такой блок должен быть только один, в него не должно быть входящих связей, исходящая связь из этого элемента должна быть только одна. Процесс интерпретации диаграммы начинается именно с этого блока.</td>
  </tr>

  <tr>
    <td>Конец</td>
    <td><img src="pics/blocks-finalBlock.png" alt="Конец"></td>
    <td>Конец программы. Если программа состоит из нескольких параллельных участков выполнения, достижение этого блока завершает этот участок. У данного блока не может быть исходящих связей.</td>
  </tr>
</table>

<br/>

<h4>Функциональные блоки</h4>

<table cellspacing="2" border="1" cellpadding="5" width="800" >
  <tr>
    <td>Название элемента</td>
    <td>Пиктограмма</td>
    <td>Описание</td>
  </tr>
  <tr>
    <td>Моторы вперёд</td>
    <td><img src="pics/blocks-enginesForwardBlock.png" alt="Моторы вперёд"></td>
    <td>Включить моторы по заданным портам с заданной мощностью. Порты задаются буквами A, B или C, разделенными запятыми. Мощность задается в процентах числом от -100 до 100, если задано отрицательное значение, мотор включается в режиме реверса. Можно также задать предел оборотов (в градусах), после которых мотор отключится (если задан 0, значение игнорируется). Так, на картинке изображена команда включения моторов на портах A и B с мощностью 100%.</td>
  </tr>
  <tr>
    <td>Моторы назад</td>
    <td><img src="pics/blocks-enginesBackwardBlock.png" alt="Моторы назад"></td>
    <td>Включить моторы в режиме реверса по заданным портам с заданной мощностью. Параметры аналогичны параметрами блока "Моторы вперёд".</td>
  </tr>
  <tr>
    <td>Моторы стоп</td>
    <td><img src="pics/blocks-enginesStopBlock.png" alt="Моторы стоп"></td>
    <td>Выключить моторы по заданным портам.</td>
  </tr>
  <tr>
    <td>Таймер</td>
    <td><img src="pics/blocks-timerBlock.png" alt="Моторы стоп"></td>
    <td>Ждать заданное количество времени, в миллисекундах.</td>
  </tr>
  <tr>
    <td>Гудок</td>
    <td><img src="pics/blocks-beepBlock.png" alt="Гудок"></td>
    <td>Проиграть на роботе звук с фиксированной частотой. Имеется один параметр — ждать ли завершения проигрывания звука или сразу же перейти к следующему блоку. Допустимые значения — true и false.</td>
  </tr>
  <tr>
    <td>Играть звук</td>
    <td><img src="pics/blocks-toneBlock.png" alt="Играть звук"></td>
    <td>Проиграть на роботе звук с заданной частотой и длительностью. Аналогичен блоку "Гудок", но позволяет задавать параметры звука. Имеется параметр, определяющий, ждать ли завершения проигрывания звука или сразу же перейти к следующему блоку. </td>
  </tr>
  <tr>
    <td>Ждать сенсор касания</td>
    <td><img src="pics/blocks-waitTouchBlock.png" alt="Ждать сенсор касания"></td>
    <td>Ждать, пока не сработает сенсор касания. Параметром указывается номер порта, к которому подключен сенсор касания. Допустимые значения: 1, 2, 3, 4.</td>
  </tr>
  <tr>
    <td>Ждать сонар</td>
    <td><img src="pics/blocks-waitSonarBlock.png" alt="Ждать сенсор касания"></td>
    <td>Ждать, пока расстояние, возвращаемое ультразвуковым сенсором расстояния, не будет сравнимо с указанным в значении параметра "Расстояние" (расстояние задается в сантиметрах, от 0 до 255). Еще один парамер — номер порта, к которому подключен датчик расстояния. Также параметром указывается операция, которая будет использоваться для сравнения с введенным расстоянием. Так, при выполнении приведенного блока выполнение программы остановится до тех пор, пока значение, возвращаемое сонаром, не будет меньше, чем 40 см.</td>
  </tr>
  <tr>
    <td>Ждать цвет</td>
    <td><img src="pics/blocks-waitColorBlock.png" alt="Ждать цвет"></td>
    <td></td>
  </tr>
  <tr>
    <td>Ждать интенсивность</td>
    <td><img src="pics/blocks-waitIntensityBlock.png" alt="Ждать интенсивность"></td>
    <td></td>
  </tr>
</table>

<br/>

<h4>Логические блоки</h4>

<table cellspacing="2" border="1" cellpadding="5" width="800" >
  <tr>
    <td>Название элемента</td>
    <td>Пиктограмма</td>
    <td>Описание</td>
  </tr>
  <tr>
    <td>Породить поток</td>
    <td><img src="pics/blocks-forkBlock.png" alt="Породить поток"></td>
    <td>Разделить выполнение программы на несколько потоков, которые с точки зрения программиста будут выполняться параллельно. Так, например, можно одновременно ждать срабатывания сенсора или истечения временного интервала. Блок должен иметь хотя бы две исходящие связи.</td>
  </tr>
  <tr>
    <td>Функция</td>
    <td><img src="pics/blocks-functionBlock.png" alt="Функция"></td>
    <td>Посчитать значение некоего выражения. Также в данном блоке допускается определение переменных. Подробнее про синтаксис допустимых выважений параметра "Функция" см. в разделе <a href="programming.html#functions">Синтаксис выражений</a>.</td>
  </tr>
  <tr>
    <td>Условие</td>
    <td><img src="pics/blocks-ifBlock.png" alt="Условие"></td>
    <td>Разделить выполнение программы в соответствии с заданным условием. Значением параметра "Условие" является некое арифметическое выражение (подробнее см. раздел <a href="programming.html#functions">Синтаксис выражений</a>),  на основе значения которого будет осуществлен выбор дальнейшего пути выполнения диаграммы. У данного блока должны быть две исходящие связи, у одной из которых должно быть задано значение параметра "Условие" (возможные варианты — "больше 0", "меньше 0", "равно 0"). При невыполнении данного условия выполнение передается по другой связи.</td>
  </tr>
  <tr>
    <td>Блок инициализации</td>
    <td><img src="pics/blocks-initBlock.png" alt="Блок инициализации"></td>
    <td></td>
  </tr>
  <tr>
    <td>Цикл</td>
    <td><img src="pics/blocks-loopBlock.png" alt="Цикл"></td>
    <td>Блок, организующий выполнение последовательности блоков несколько раз. Число повторений задается значением параметра "Итераций". Блок должен иметь две исходящие связи, одна из которых должна быть помечена значением "итерация" (то есть значение параметра "Условие" должно быть "итерация"). Другая связь, исходящая из блока "Цикл" должна оставаться непомеченной, по ней будет осуществляться переход, когда программа пройдет через блок "Цикл" указанное число раз.</td>
  </tr>
</table>

<br/><br/>

<h3><a name="links">Создание связей</a></h3>

Связи между элементами в QReal:Robots обозначают направление передачи управления между блоками. Это означает, что если Вы хотите, например, чтобы вслед за включением моторов робот сразу же издал звуковой сигнал, Вам необходимо соединить эти два блока стрелкой, имеющей направление от блока включения моторов к блоку звукового сигнала:

<br/><br/>

<center><img src="pics/programming-links.png" alt="Связь в QReal:Robots"></center>

<br/>

<div>
Связи в QReal:Robots можно создавать несколькими способами. <i>Первый подход</i> аналогичен созданию блоков — нужно найти в палитре элементов соответствующую пиктограмму ("Поток управления") и перетащить его в нужное место диаграммы. При этом если "бросить" эту пиктограмму на уже существующий блок, то связь автоматически прикрепится к этому элементу. Если навести на связь курсор мыши, то на ее концах отобразятся серые маркеры:
</div>

<br/><br/>

<center><img src="pics/programming-link-selected.png" alt="Выделение связи"></center>

<br/>

<div>
Потянув за один из этих маркеров, можно управлять тем, к каким блокам присоединен тот или иной конец данной связи. Так, чтобы присоединить один из концов связи к блоку, нужно потянуть за соответствующий серый маркер и отпустить его на интересующем блоке. 
</div>

<br/><br/>

<div>
<i>Второй подход</i> не требует перетаскивания элементов из палитры. Для того, чтобы создать связь между двумя элементами A и B, нужно навести курсор на элемент A, зажать <b>правую</b> кнопку мыши и провести линию до элемента B (форма линии может быть произвольной, важно, чтобы она начиналась строго на элементе A и заканчивалась на элементе B). При этом на сцене это будет отражено следующим образом (элемент A в нашем случае — это блок "Начало", B — блок "Конец"):
</div>

<br/><br/>

<center><img src="pics/programming-links-gesture.png" alt="Создание связи жестом мышью"></center>

<br/>

<div>При отпускании правой кнопки мыши элементы A и B окажутся соединенными связью:</div>

<br/><br/>

<center><img src="pics/programming-links-gesture-ok.png" alt="Создание связи жестом мышью"></center>

<br/><br/>

<div>
<i>Третий подход</i> — линкеры, но они у меня почему-то не работаэ, поэтому скриншотов не будет.
</div>

<br/><br/>

<div>
Связи в QReal:Robots могут быть ломаными линиям. Для того, чтобы добавить новую точку излома, нужно навести курсор мыши на точку линии связи, где хочется сделать излом, нажать левой кнопкой мыши и потянуть появившийся серый маркер: 
</div>

<center><img src="pics/programming-link-polygon.png" alt="Создание точек излома"></center>
<br/><br/>

<div>
При этом, если точку излома связи разместить так, что она и две ближайших к ней будут располагаться примерно на одной прямой (см. рисунок ниже), то это приведет к уничтожению этой точки излома и сглаживанию ломаной в этом месте:
</div>

<center><img src="pics/programming-link-remove-point.png" alt="Удаление точек излома"></center>
<br/><br/>

<div>
Также удалить точку излома можно, нажав на соответствующий ей серый маркер правой кнопкой мыши и выбрав пункт выпадающего меню "Удалить точку":
</div>

<center><img src="pics/programming-link-remove-menu.png" alt="Удаление точек излома"></center>
<br/><br/>

<div>
При выборе пункта меню "Уменьшить" все точки изломов связи уничтожаются.
</div>

<h3><a name="functions">Синтаксис выражений</a></h3>

<h3><a name="properties">Редактирование свойств элементов</a></h3>

<div>
В QReal:Robots имеется несколько способов редактирования начений свойств, которые имеются у блоков и связей на диаграммах. Основным из них является использование редактора свойств (см. раздел <a href="interface.html">Интерфейс QReal:Robots</a>). При выделении блока связи или элемента на сцене в редакторе свойств начинают отображаться все свойства текущего элемента (на рисунке представлено изображение редактора свойств блока "Моторы вперёд"):
</div>

<center><img src="pics/programming-property-editor.png" alt="Редактор свойств"></center>
<br/><br/>

<div>
Редактор свойств представляет собой таблицу, в которой в левой колонке отображается название свойства элемента, а в левой — его значение. Изменить значение любого свойства можно кликнув на соответствующей ячейке правой колонки и введя нужное значение. Для свойств, которые допускают только определенный набор значений (например, свойство "Порт" у блока "Ждать сенсор касания") при попытке их редактирования появится выпадающее меню, в котором нужно выбрать интересующее значение:
</div>

<center><img src="pics/programming-property-editor-combobox.png" alt="Редактор свойств"></center>
<br/><br/>

<div>
Помимо редактора свойств, значения свойств элементов можно редактировать прямо на диаграмме. Для этого нужно навести курсор мыши на значение нужного свойства, двойным нажатием левой кнопки мыши активировать редактирование свойства, ввести нужное значение и кликнуть в произвольное место сцены. Стоит отметить, что данный подход может служить источником ошибок, поскольку позволяет ввести произвольное текстовое значение свойства, в том числе и некорректное. Будьте осторожны.
</div>

</body>
</html>